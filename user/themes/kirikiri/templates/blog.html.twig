{% extends 'partials/base.html.twig' %}

{% block content %}
    {% if uri.param('tag') %}
        <h1 class="page-title">Teema: {{ uri.param('tag') }}</h1>
    {% elseif uri.param('author') %}
        <h1 class="page-title">Autor: {{ uri.param('author') }}</h1>
    {% else %}
        <h1 class="page-title">Artiklite arhiiv</h1>
    {% endif %}

    <div class="post-grid">
        {% set posts = page.collection() %}
        {% for post in posts %}
            <article class="card">
                {% if post.header.image %}
                    <a href="{{ post.url }}" class="card-image-link">
                        <img src="{{ post.media[post.header.image].url }}" alt="{{ post.title }}" class="card-image">
                    </a>
                {% endif %}
                
                <div class="card-content">
                    <div class="card-category">
                        {% for tag in post.taxonomy.tag %}
                            <a href="{{ base_url }}/blog/tag:{{ tag }}">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                        {% else %}
                            Artikkel
                        {% endfor %}
                    </div>
                    <h3 class="card-title">
                        <a href="{{ post.url }}">{{ post.title }}</a>
                    </h3>
                    <div class="card-excerpt {{ post.title|length < 50 ? 'excerpt-long' : '' }}">
                        {% if post.title|length < 50 %}
                            {{ post.content|striptags|truncate(280, true, ' ...')|raw }}
                        {% else %}
                            {{ post.summary|striptags }}
                        {% endif %}
                    </div>
                    <div class="card-footer">
                        {% set months = ["jaanuar", "veebruar", "märts", "aprill", "mai", "juuni", "juuli", "august", "september", "oktoober", "november", "detsember"] %}
                        <span class="card-date">{{ post.date|date("j.") }} {{ months[post.date|date("n") - 1] }} {{ post.date|date("Y") }}</span>
                        {% if post.taxonomy.author is iterable %}
                            {% set author = post.taxonomy.author|first %}
                        {% elseif post.header.taxonomy.author %}
                            {% set author = post.header.taxonomy.author|first %}
                        {% else %}
                            {% set author = post.header.author %}
                        {% endif %}
                        
                        {% if author %}
                            <span class="card-author">
                                <a href="{{ base_url }}/blog/author:{{ author|url_encode }}">{{ author }}</a>
                            </span>
                        {% endif %}
                    </div>
                    <a href="{{ post.url }}" class="read-more-link">Loe edasi →</a>
                </div>
            </article>
        {% endfor %}
    </div>

    {% if config.plugins.pagination.enabled and posts.params.pagination %}
        <div class="pagination">
            {% if posts.params.pagination.has_prev %}
                <a href="{{ posts.params.pagination.prev_url }}" class="pagination-prev">← Eelmised</a>
            {% endif %}
            <span class="pagination-info">Lehekülg {{ posts.params.pagination.current_page }} / {{ posts.params.pagination.total_pages }}</span>
            {% if posts.params.pagination.has_next %}
                <a href="{{ posts.params.pagination.next_url }}" class="pagination-next">Järgmised →</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
